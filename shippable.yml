language: python

python:
  - 2.7

services:
  - mysql

env:
  global:
    - GAE_DIR=/tmp/gae
    # the following secure variable is the json key for the app engine project's service account
    - secure: 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
    
build:
  ci:
    - echo $GAE_DIR
    # - >
    #   test -e $GAE_DIR ||
    #   (mkdir -p $GAE_DIR &&
    #   wget https://storage.googleapis.com/appengine-sdks/featured/google_appengine_1.9.35.zip -q -O /tmp/gae.zip &&
    #   unzip /tmp/gae.zip -d $GAE_DIR)
    - pip install -r requirements.txt
    - mkdir -p shippable/testresults
    - mkdir -p shippable/codecoverage
    - coverage run manage.py test
  on_success:
    - echo 'yay'
    # - echo "$GAE_PASSWORD" | $GAE_DIR/google_appengine/appcfg.py -e "$EMAIL" -A "testgkeproject-1181" --noisy list_versions
    - supress=$(echo $SERVICE_ACCOUNT_KEY > /tmp/key.json)
    - gcloud -q auth activate-service-account --verbosity=debug --key-file /tmp/key.json
    - gcloud config set project testgkeproject-1181
    - gcloud config list
    - sudo apt-get install tree
    - tree $SHIPPABLE_REPO_DIR
    - gcloud preview app deploy $SHIPPABLE_REPO_DIR/app.yaml



