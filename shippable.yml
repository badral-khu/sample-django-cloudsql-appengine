language: python

python:
  - 2.7

services:
  - mysql

env:
  global:
    - GAE_DIR=/tmp/gae
    # the following secure variable is the json key for the app engine project's service account
    - secure: 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

build:
  ci:
    - echo $GAE_DIR
    # - >
    #   test -e $GAE_DIR ||
    #   (mkdir -p $GAE_DIR &&
    #   wget https://storage.googleapis.com/appengine-sdks/featured/google_appengine_1.9.35.zip -q -O /tmp/gae.zip &&
    #   unzip /tmp/gae.zip -d $GAE_DIR)
    - pip install -r requirements.txt
    - mkdir -p shippable/testresults
    - mkdir -p shippable/codecoverage
    - coverage run manage.py test
  on_success:
    - echo 'yay'
    # - echo "$GAE_PASSWORD" | $GAE_DIR/google_appengine/appcfg.py -e "$EMAIL" -A "testgkeproject-1181" --noisy list_versions
    - supress=$(echo $SERVICE_ACCOUNT_KEY > /tmp/key.json)
    - gcloud -q auth activate-service-account --verbosity=debug --key-file /tmp/key.json
    - gcloud config set project testgkeproject-1181
    - gcloud config list
    - sudo apt-get install tree
    - tree $SHIPPABLE_REPO_DIR
    - gcloud preview app deploy $SHIPPABLE_REPO_DIR/app.yaml



